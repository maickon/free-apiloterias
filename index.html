<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Loterias — Free API</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="icon" type="image/png" href="/free-apiloterias/img/icon.png">
    </head>
    <body class="bg-gray-50 text-gray-800 overflow-y-hidden h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b sticky top-0 z-10 w-full">
          <div class="flex items-center justify-between  py-4 max-w-7xl mx-auto">
            <!-- Lado esquerdo: logo + título -->
            <div class="flex items-center gap-3">
              <img src="/free-apiloterias/img/icon.png" class="w-8 h-8">
              <h1 class="text-xl font-bold text-gray-900">Loterias — Free API</h1>
            </div>

            <!-- Lado direito: link -->
            <nav>
              <a href="https://www.apiloterias.com" target="_blank" class="text-sm text-blue-600 hover:text-blue-800 font-semibold">
                Site Oficial
              </a>
            </nav>
          </div>
        </header>


        <!-- Container principal -->
        <div class="flex" style="height: calc(100vh - 64px);">
            <!-- 64px = altura do header -->
            <!-- Sidebar -->
            <aside class="w-72 bg-white border-r p-6 overflow-y-auto">
                <h2 class="text-lg font-semibold mb-4">Endpoints</h2>
                <ul id="lotteries-list" class="space-y-6">
                    <!-- JS vai popular aqui -->
                </ul>
            </aside>
            <!-- Main content -->
            <main class="flex-1 p-6 flex flex-col">
                <div class="bg-white shadow rounded-xl p-6 flex-1 overflow-y-auto">
                    <h2 class="text-lg font-semibold text-gray-900 mb-2">Resposta</h2>
                    <p id="meta" class="text-sm text-gray-500 mb-4">Selecione um endpoint para visualizar os dados.</p>
                    <pre id="output" class="bg-gray-900 text-green-300 text-sm p-4 rounded-lg overflow-auto">{
  "message": "Use /concurso/megasena/1 ou outros endpoints"
}</pre>
                </div>
            </main>
        </div>
        <script>
            // Loterias disponíveis
            const LOTTERIES = ["diadesorte", "duplasena", "federal", "loteca", "lotofacil", "lotomania", "maismilionaria", "megasena", "quina", "supersete", "timemania"];
            
            // Detecta se está rodando no GitHub Pages
            const isGithubPages = window.location.hostname.includes("github.io");

            // Define o caminho do banco de dados
            const DATABASE_PATH = isGithubPages ? "/free-apiloterias/database" : "/database";

            const el = (id) => document.getElementById(id);
            const safeJSON = (obj) => JSON.stringify(obj, null, 2);
            
            function showOutput(text, metaText) {
              const outputEl = el("output");
              const metaEl = el("meta");

              // Mostra o JSON formatado
              outputEl.textContent = text;

              if (metaText) {
                // metaText esperado no formato: "Fonte: /database/megasena/1.json"
                const [label, path] = metaText.split(": ");
                const linkUrl = `${window.location.origin}${path}`;

                // Mostra "Fonte: " seguido de link clicável
                metaEl.innerHTML = `${label}: <a href="${linkUrl}" target="_blank" class="blank text-blue-600 hover:underline">${path}</a>`;
  
              } else {
                metaEl.textContent = "";
              }
            }

            
            // Renderiza links no sidebar
            function renderLotteriesList() {
              const list = el("lotteries-list");
              list.innerHTML = "";
              for (const name of LOTTERIES) {
                const li = document.createElement("li");
                li.innerHTML = `
                  <div>
                    <p class="font-semibold text-gray-700 mb-1">${name}</p>
                    <ul class="text-sm space-y-1">
                      <li><a href="/concurso/${name}/1" class="block text-blue-600 hover:underline">/${name}/concurso/1</a></li>
                      <li><a href="/concurso/${name}/todos" class="block text-blue-600 hover:underline">/${name}/concurso/todos</a></li>
                      <li><a href="/concurso/${name}/ultimo" class="block text-blue-600 hover:underline">/${name}/concurso/ultimo</a></li>
                    </ul>
                  </div>`;
                list.appendChild(li);
              }
            }
            
            // Busca um endpoint
            async function fetchData(lottery, param) {
              let url;
              if (param === "todos") {
                url = `${DATABASE_PATH}/${lottery}/todos.json`;
              } else if (param === "ultimo") {
                url = `${DATABASE_PATH}/${lottery}/ultimo.json`;
              } else {
                url = `${DATABASE_PATH}/${lottery}/${param}.json`;
              }
              console.log(url)
              const res = await fetch(url);
              if (!res.ok) throw new Error(`Erro ao buscar ${url}`);
              return { source: url, data: await res.json() };
            }
            
            // Router
            async function handleRoute() {
              const path = window.location.pathname.split("/").filter(Boolean);
              if (path.length < 3) return;
              const [, lottery, param] = path;
            
              try {
                const result = await fetchData(lottery, param);
                showOutput(safeJSON(result.data), `Fonte: ${result.source}`);
              } catch (e) {
                showOutput(`Erro: ${e.message}`, "Erro");
              }
            }
            
            // Navegação tipo SPA
            function enableRouterLinks() {
              document.addEventListener("click", (ev) => {
                const a = ev.target.closest("a");
                if (!a) return;

                // Ignora links externos ou com classe 'blank'
                if (!a.getAttribute("href").startsWith("/") || a.classList.contains("blank")) return;

                ev.preventDefault();
                history.pushState({}, "", a.getAttribute("href"));
                handleRoute();
              });

              window.addEventListener("popstate", handleRoute);
            }

            
            // Init
            renderLotteriesList();
            enableRouterLinks();
            handleRoute();
        </script>
    </body>
</html>